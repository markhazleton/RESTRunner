@{
    ViewData["Title"] = "Settings";
}

<div class="container-fluid">
    <!-- Page Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">RESTRunner Settings</h1>
        <a href="/Runner" class="btn btn-outline-secondary">Back to Dashboard</a>
    </div>

    <div class="row">
        <!-- System Settings -->
        <div class="col-lg-8">
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">System Configuration</h5>
                </div>
                <div class="card-body">
                    <form class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Default Concurrency Limit</label>
                                    <input type="number" class="form-control" value="10" min="1" max="100">
                                    <div class="form-text">Maximum concurrent requests for new configurations</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Default Iterations</label>
                                    <input type="number" class="form-control" value="100" min="1" max="1000">
                                    <div class="form-text">Default number of iterations for new configurations</div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Request Timeout (seconds)</label>
                                    <input type="number" class="form-control" value="30" min="5" max="300">
                                    <div class="form-text">Default timeout for HTTP requests</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Retry Attempts</label>
                                    <input type="number" class="form-control" value="3" min="0" max="10">
                                    <div class="form-text">Number of retry attempts for failed requests</div>
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Results Export Directory</label>
                            <input type="text" class="form-control" value="./Data/results/" readonly>
                            <div class="form-text">Directory where execution results are stored</div>
                        </div>

                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="enableDetailedLogging" checked>
                            <label class="form-check-label" for="enableDetailedLogging">
                                Enable Detailed Logging
                            </label>
                            <div class="form-text">Log detailed information about each request</div>
                        </div>

                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="autoCleanup" checked>
                            <label class="form-check-label" for="autoCleanup">
                                Auto-cleanup Old Results
                            </label>
                            <div class="form-text">Automatically delete results older than 30 days</div>
                        </div>
                    </form>
                </div>
                <div class="card-footer">
                    <button type="button" class="btn btn-primary" id="saveSettings">
                        Save Settings
                    </button>
                    <button type="button" class="btn btn-outline-secondary" id="resetSettings">
                        Reset to Defaults
                    </button>
                </div>
            </div>

            <!-- File Management -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">File Management</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 text-center mb-3">
                            <div class="card border-info">
                                <div class="card-body">
                                    <div class="h2 text-info mb-2">CONF</div>
                                    <h6>Configurations</h6>
                                    <p class="mb-1"><strong id="configCount">Loading...</strong></p>
                                    <small class="text-muted">JSON files</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="card border-success">
                                <div class="card-body">
                                    <div class="h2 text-success mb-2">COLL</div>
                                    <h6>Collections</h6>
                                    <p class="mb-1"><strong id="collectionCount">Loading...</strong></p>
                                    <small class="text-muted">Postman files</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-center mb-3">
                            <div class="card border-warning">
                                <div class="card-body">
                                    <div class="h2 text-warning mb-2">RESULTS</div>
                                    <h6>Results</h6>
                                    <p class="mb-1"><strong id="resultCount">Loading...</strong></p>
                                    <small class="text-muted">Execution results</small>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                        <button type="button" class="btn btn-warning" id="cleanupOldFiles">
                            Cleanup Old Files
                        </button>
                        <button type="button" class="btn btn-info" id="exportAllConfigs">
                            Export All Configurations
                        </button>
                        <button type="button" class="btn btn-secondary" id="refreshStats">
                            Refresh Statistics
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Information -->
        <div class="col-lg-4">
            <!-- System Status -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">System Status</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Application Status:</span>
                            <span class="badge bg-success">Running</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Uptime:</span>
                            <span id="uptime">Loading...</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Version:</span>
                            <span class="badge bg-info">1.0.0</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>Environment:</span>
                            <span class="badge bg-primary">Development</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span>.NET Version:</span>
                            <span class="badge bg-secondary">9.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Storage Information -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">Storage Information</h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label">Data Directory</label>
                        <code class="d-block p-2 bg-light rounded">./Data/</code>
                    </div>
                    <div class="row text-center">
                        <div class="col-4">
                            <small class="text-muted">Configurations</small>
                            <div><strong id="configSize">-- KB</strong></div>
                        </div>
                        <div class="col-4">
                            <small class="text-muted">Collections</small>
                            <div><strong id="collectionSize">-- KB</strong></div>
                        </div>
                        <div class="col-4">
                            <small class="text-muted">Results</small>
                            <div><strong id="resultSize">-- KB</strong></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0">Quick Actions</h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="/Runner/Status" class="btn btn-outline-primary btn-sm">
                            System Health Check
                        </a>
                        <a href="/Configuration" class="btn btn-outline-success btn-sm">
                            Manage Configurations
                        </a>
                        <a href="/Collection" class="btn btn-outline-info btn-sm">
                            Manage Collections
                        </a>
                        <a href="/docs" class="btn btn-outline-secondary btn-sm">
                            API Documentation
                        </a>
                    </div>
                </div>
            </div>

            <!-- About -->
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">About RESTRunner</h6>
                </div>
                <div class="card-body">
                    <p class="small text-muted">
                        RESTRunner is a comprehensive REST API testing platform built with .NET 9 and ASP.NET Core.
                    </p>
                    <p class="small text-muted mb-0">
                        <strong>Features:</strong> Postman integration, performance testing, multi-instance testing, and detailed analytics.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Load system status
        function loadSystemStatus() {
            fetch('/Runner/Status')
                .then(response => response.json())
                .then(data => {
                    if (data.uptime) {
                        document.getElementById('uptime').textContent = formatUptime(data.uptime);
                    }
                })
                .catch(error => {
                    console.error('Error loading system status:', error);
                    document.getElementById('uptime').textContent = 'Unknown';
                });
        }

        // Format uptime duration
        function formatUptime(uptime) {
            // Assuming uptime is in format "00:00:00" or similar
            return uptime || 'Unknown';
        }

        // Load file counts (mock data for now)
        function loadFileCounts() {
            // These would be real API calls in a full implementation
            document.getElementById('configCount').textContent = '5 files';
            document.getElementById('collectionCount').textContent = '3 files';
            document.getElementById('resultCount').textContent = '12 files';
            
            document.getElementById('configSize').textContent = '45 KB';
            document.getElementById('collectionSize').textContent = '128 KB';
            document.getElementById('resultSize').textContent = '2.3 MB';
        }

        // Save settings
        document.getElementById('saveSettings').addEventListener('click', function() {
            // In a real implementation, this would save to the server
            alert('Settings saved successfully! (This is a demo - settings are not actually persisted)');
        });

        // Reset settings
        document.getElementById('resetSettings').addEventListener('click', function() {
            if (confirm('Are you sure you want to reset all settings to defaults?')) {
                location.reload();
            }
        });

        // Cleanup old files
        document.getElementById('cleanupOldFiles').addEventListener('click', function() {
            if (confirm('This will delete old result files. Are you sure?')) {
                alert('Cleanup completed! (This is a demo - no files were actually deleted)');
                loadFileCounts();
            }
        });

        // Export all configurations
        document.getElementById('exportAllConfigs').addEventListener('click', function() {
            alert('Export feature coming soon! This will download all configurations as a ZIP file.');
        });

        // Refresh statistics
        document.getElementById('refreshStats').addEventListener('click', function() {
            loadSystemStatus();
            loadFileCounts();
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadSystemStatus();
            loadFileCounts();
        });
    </script>
}